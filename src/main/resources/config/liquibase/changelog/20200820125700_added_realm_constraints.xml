<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet id="20200820125700" author="ir73">

        <dropForeignKeyConstraint baseTableName="user_group_permission"
                                  constraintName="fk_user_grp_name" />

        <dropForeignKeyConstraint baseTableName="user_user_group"
                                  constraintName="fk_user_group_name" />

<!--        <addUniqueConstraint columnNames="name, realm_id"-->
<!--                             constraintName="pk_user_group"-->
<!--                             tableName="user_group"/>-->

<!--        <dropPrimaryKey constraintName="pk_user_group" tableName="user_group"/>-->
        <sql>
            ALTER TABLE public.user_group DROP CONSTRAINT pk_user_group;
        </sql>

        <addPrimaryKey columnNames="name, realm_id"
                             constraintName="pk_user_group"
                             tableName="user_group"/>

<!--        <dropIndex indexName="pk_user_group" tableName="user_group"/>-->

        <addForeignKeyConstraint baseTableName="user_group_permission"
                                 baseColumnNames="user_grp_name, realm_id"
                                 constraintName="fk_user_grp_name_realm_id"
                                 referencedTableName="user_group"
                                 referencedColumnNames="name, realm_id"/>

        <addForeignKeyConstraint baseTableName="user_user_group"
                                 baseColumnNames="user_group_name"
                                 constraintName="fk_user_group_name_ream_id"
                                 referencedTableName="user_group"
                                 referencedColumnNames="name, realm_id"/>

    </changeSet>
</databaseChangeLog>
